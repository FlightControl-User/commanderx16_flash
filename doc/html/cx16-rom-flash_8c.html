<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Commander X16 ROM Flash Utility: src/cx16-rom-flash.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Commander X16 ROM Flash Utility
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">This program flashes the ROM of the Commander X16 with a new ROM.BIN file.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('cx16-rom-flash_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">cx16-rom-flash.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>COMMANDER X16 ROM FLASH UTILITY.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;cx16.h&gt;</code><br />
<code>#include &lt;<a class="el" href="cx16-file_8h_source.html">cx16-file.h</a>&gt;</code><br />
<code>#include &lt;conio.h&gt;</code><br />
<code>#include &lt;printf.h&gt;</code><br />
<code>#include &lt;6502.h&gt;</code><br />
<code>#include &lt;kernal.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for cx16-rom-flash.c:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c__incl.png" border="0" usemap="#asrc_2cx16-rom-flash_8c" alt=""/></div>
<map name="asrc_2cx16-rom-flash_8c" id="asrc_2cx16-rom-flash_8c">
<area shape="rect" title="COMMANDER X16 ROM FLASH UTILITY." alt="" coords="185,5,325,32"/>
<area shape="rect" title=" " alt="" coords="5,155,67,181"/>
<area shape="rect" href="cx16-file_8h.html" title=" " alt="" coords="74,80,155,107"/>
<area shape="rect" title=" " alt="" coords="180,80,244,107"/>
<area shape="rect" title=" " alt="" coords="268,80,329,107"/>
<area shape="rect" title=" " alt="" coords="353,80,415,107"/>
<area shape="rect" title=" " alt="" coords="439,80,507,107"/>
<area shape="rect" title=" " alt="" coords="91,155,178,181"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a67e0112c2a09b158464debe902a7c861"><td class="memItemLeft" align="right" valign="top"><a id="a67e0112c2a09b158464debe902a7c861"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>__FLASH</b></td></tr>
<tr class="separator:a67e0112c2a09b158464debe902a7c861"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a652cff0033969443cc2f6f5389fbd9"><td class="memItemLeft" align="right" valign="top"><a id="a8a652cff0033969443cc2f6f5389fbd9"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ROM_BASE</b>&#160;&#160;&#160;((unsigned int)0xC000)</td></tr>
<tr class="separator:a8a652cff0033969443cc2f6f5389fbd9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9e53d1418399b36953a40395ac1384d"><td class="memItemLeft" align="right" valign="top"><a id="ad9e53d1418399b36953a40395ac1384d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ROM_SIZE</b>&#160;&#160;&#160;((unsigned int)0x4000)</td></tr>
<tr class="separator:ad9e53d1418399b36953a40395ac1384d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f2b7fa249d9d3affd06e7edfef1eff0"><td class="memItemLeft" align="right" valign="top"><a id="a8f2b7fa249d9d3affd06e7edfef1eff0"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ROM_PTR_MASK</b>&#160;&#160;&#160;((unsigned long)0x03FFF)</td></tr>
<tr class="separator:a8f2b7fa249d9d3affd06e7edfef1eff0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99719b21a5d2432f868eac80997d77e7"><td class="memItemLeft" align="right" valign="top"><a id="a99719b21a5d2432f868eac80997d77e7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ROM_BANK_MASK</b>&#160;&#160;&#160;((unsigned long)0x7C000)</td></tr>
<tr class="separator:a99719b21a5d2432f868eac80997d77e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac224fac45a334ea85c5f091ab66037dd"><td class="memItemLeft" align="right" valign="top"><a id="ac224fac45a334ea85c5f091ab66037dd"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SST39SF010A</b>&#160;&#160;&#160;((unsigned char)0xB5)</td></tr>
<tr class="separator:ac224fac45a334ea85c5f091ab66037dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9073d886536fd49114afae0f29b28b27"><td class="memItemLeft" align="right" valign="top"><a id="a9073d886536fd49114afae0f29b28b27"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SST39SF020A</b>&#160;&#160;&#160;((unsigned char)0xB6)</td></tr>
<tr class="separator:a9073d886536fd49114afae0f29b28b27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a998c69bda3842e763def0f6c8bc75fd2"><td class="memItemLeft" align="right" valign="top"><a id="a998c69bda3842e763def0f6c8bc75fd2"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SST39SF040</b>&#160;&#160;&#160;((unsigned char)0xB7)</td></tr>
<tr class="separator:a998c69bda3842e763def0f6c8bc75fd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1fd06ed563d27103c3ea13b94d4de6d5"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5">rom_bank</a> (unsigned long address)</td></tr>
<tr class="memdesc:a1fd06ed563d27103c3ea13b94d4de6d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking the upper 5 bits (bit 18-14) and shifing those 14 bits to the right.  <a href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5">More...</a><br /></td></tr>
<tr class="separator:a1fd06ed563d27103c3ea13b94d4de6d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45f13cdc8334c213332cdd8edac28015"><td class="memItemLeft" align="right" valign="top">brom_ptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015">rom_ptr</a> (unsigned long address)</td></tr>
<tr class="memdesc:a45f13cdc8334c213332cdd8edac28015"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is calculated by masking the lower 14 bits (bit 13-0), and then adding $C000 to it. The 16 bit ROM pointer is returned as a char* (brom_ptr_t).  <a href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015">More...</a><br /></td></tr>
<tr class="separator:a45f13cdc8334c213332cdd8edac28015"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85a543d5bc42e5a467cbdcd519163ab0"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a85a543d5bc42e5a467cbdcd519163ab0">rom_read_byte</a> (unsigned long address)</td></tr>
<tr class="memdesc:a85a543d5bc42e5a467cbdcd519163ab0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a byte from the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are transformed into the <b>ptr_rom</b> 16 bit ROM address. The higher 5 bits of the 19 bit ROM address are transformed into the <b>bank_rom</b> 5 bit bank number. <b>bank_ptr* is used to set the bank using ZP $01. **ptr_rom</b> is used to read the byte.  <a href="cx16-rom-flash_8c.html#a85a543d5bc42e5a467cbdcd519163ab0">More...</a><br /></td></tr>
<tr class="separator:a85a543d5bc42e5a467cbdcd519163ab0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42ba9278c9feb3135a6bb465e8e2450a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a">rom_write_byte</a> (unsigned long address, unsigned char value)</td></tr>
<tr class="memdesc:a42ba9278c9feb3135a6bb465e8e2450a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are transformed into the <b>ptr_rom</b> 16 bit ROM address. The higher 5 bits of the 19 bit ROM address are transformed into the <b>bank_rom</b> 5 bit bank number. <b>bank_ptr* is used to set the bank using ZP $01. **ptr_rom</b> is used to write the byte into the ROM.  <a href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a">More...</a><br /></td></tr>
<tr class="separator:a42ba9278c9feb3135a6bb465e8e2450a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a413ddcf851b4da292eb4391f72918ee9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a413ddcf851b4da292eb4391f72918ee9">rom_wait</a> (brom_ptr_t ptr_rom)</td></tr>
<tr class="memdesc:a413ddcf851b4da292eb4391f72918ee9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for the required time to allow the chip to flash the byte into the ROM. This is a core wait routine which is the most important routine in this whole program. Once a byte is flashed into the ROM, it takes time for the chip to actually flash the byte. The chip has implemented a loop mechanism to guarantee correct flashing of the written byte. It does this by requiring the execution of two sequential reads from the previously written ROM address. And loop those sequential reads until bit 6 of the 2 read bytes are equal. Once those two bits are equal, the chip has successfully flashed the byte into the ROM.  <a href="cx16-rom-flash_8c.html#a413ddcf851b4da292eb4391f72918ee9">More...</a><br /></td></tr>
<tr class="separator:a413ddcf851b4da292eb4391f72918ee9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f4369522c0458285f171bda1eade3d9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a5f4369522c0458285f171bda1eade3d9">rom_unlock</a> (unsigned long address, unsigned char unlock_code)</td></tr>
<tr class="memdesc:a5f4369522c0458285f171bda1eade3d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to unlock the ROM for flashing a byte. The 3rd byte can be variable, depending on the write sequence used, so this byte is a parameter into the routine.  <a href="cx16-rom-flash_8c.html#a5f4369522c0458285f171bda1eade3d9">More...</a><br /></td></tr>
<tr class="separator:a5f4369522c0458285f171bda1eade3d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc8e7bb513e6936d98af34037c0f5a89"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#adc8e7bb513e6936d98af34037c0f5a89">rom_byte_program</a> (unsigned long address, unsigned char value)</td></tr>
<tr class="memdesc:adc8e7bb513e6936d98af34037c0f5a89"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write a byte and wait until the byte has been successfully flashed into the ROM.  <a href="cx16-rom-flash_8c.html#adc8e7bb513e6936d98af34037c0f5a89">More...</a><br /></td></tr>
<tr class="separator:adc8e7bb513e6936d98af34037c0f5a89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21fca991601518b6c85c5f8e70fabbbf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf">rom_sector_erase</a> (unsigned long address)</td></tr>
<tr class="memdesc:a21fca991601518b6c85c5f8e70fabbbf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be flashed into the ROM. Erasing a sector of the ROM requires an erase sector sequence to be initiated, which has the following steps:  <a href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf">More...</a><br /></td></tr>
<tr class="separator:a21fca991601518b6c85c5f8e70fabbbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdef7a1fd863a6d3770c1268cb06add3"><td class="memItemLeft" align="right" valign="top"><a id="acdef7a1fd863a6d3770c1268cb06add3"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>main</b> ()</td></tr>
<tr class="separator:acdef7a1fd863a6d3770c1268cb06add3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>COMMANDER X16 ROM FLASH UTILITY. </p>
<dl class="section author"><dt>Author</dt><dd>Sven Van de Velde (<a href="#" onclick="location.href='mai'+'lto:'+'sve'+'n.'+'van'+'.d'+'e.v'+'el'+'de@'+'te'+'len'+'et'+'.be'; return false;">sven.<span style="display: none;">.nosp@m.</span>van.<span style="display: none;">.nosp@m.</span>de.ve<span style="display: none;">.nosp@m.</span>lde@<span style="display: none;">.nosp@m.</span>telen<span style="display: none;">.nosp@m.</span>et.b<span style="display: none;">.nosp@m.</span>e</a>)</dd></dl>
<p>This flash utility can be used to flash a new ROM.BIN into ROM banks of the COMMANDER X16. <br  />
 Because the ROM.BIN is a significantly large binary, ROM flashing will only be possible using the SD CARD. Therefore, this utility follows a simple and lean upload and flashing design, keeping it as simple as possible. The utility program is to be place onto a folder of the SD card, together with the ROM.BIN. The user can then simply load the program and run it from the SD card folder to flash the ROM.</p>
<p>Embedded in the source code is the technical documentation how the ROM flash works. The main principles of ROM flashing is to <b>unlock the ROM</b> for flashing following pre-defined read/write sequences <br  />
 defined by the manufacturer of the chip. Once these sequences have been correctly initiated, a byte can be written at the specified ROM address. And this is where it gets tricky and interesting concerning the COMMANDER X16 <br  />
 address bus and architecture. <br  />
</p>
<h1><a class="anchor" id="autotoc_md1"></a>
ROM Adressing</h1>
<p>The address bus of the ROM chips follow 19 bit wide addressing mode. <br  />
 As you know, the COMMANDER X16 has 32 banks ROM of 16KB each. <br  />
 The COMMANDER X16 implements a banking solution to address these 19 bits, where the most significant 5 bits of the 19 bit address are configured through zero page $01, configuring one of the 32 ROM banks, while the main address bus is used to addresses the remaining 14 bits of the 19 bit ROM address.</p>
<p>This results in the following architecture, where this flashing program uses a combination of setting the ROM bank and the main address bus to select the 19 bit ROM address.</p>
<pre class="fragment">                              +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+  
                              | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
                              | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | 9 | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
                              +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+  
                              | BANK (ZP $01)     | MAIN ADDRESS BUS (+ $C000)                            |
                              +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+  
 ROM_BANK_MASK  0x7C000       | 1 | 1 | 1 | 1 | 1 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
                              +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+  
 ROM_PTR_MASK   0x03FFF       | 0 | 0 | 0 | 0 | 0 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 |
                              +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+  
</pre><p> There is also one important caveat to keep in mind at all times ... What does the 6502 CPU see? <br  />
 So, the CPU uses zero page $01 to set the banks, but the lower 14 bit ROM address for the CPU starts at $C000 and ends at $FFFF (16KB), as the CPU has a 16 bit address bus. So the lower 14 bits of the ROM address requires to be added with $C000.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Flasing the ROM</h1>
<p>ROM flashing is done by executing specific write sequences at specific addresses with specific bytes into the ROM. Depending on the write sequence, a specific ROM flashing function is selected. <br  />
</p>
<p>This utility uses the following ROM flashing sequences:</p>
<ul>
<li>Reading the ROM manufacturer and device ID information.</li>
<li>Clearing a ROM sector (filling with FF). Each ROM sector is 1KB wide.</li>
<li>Flashing the cleared ROM sector with the new ROM bytes.</li>
</ul>
<p>That's it. However, there is more to that ...</p>
<h1><a class="anchor" id="autotoc_md3"></a>
ROM flashing approach</h1>
<p>The ROM flashing requires a specific approach, as you need to keep in mind that while flashing ROM, there is <b>no ROM available</b>! This utility flashes the ROM in four steps:</p>
<ol type="1">
<li>Read the complete ROM.BIN file from the SD card into (banked) RAM.</li>
<li>Flash the ROM from (banked) RAM.</li>
<li>Verify that the ROM has been correctly flashed (still TODO).</li>
<li>Reset and reboot the COMMANDER X16 using the new ROM state.</li>
</ol>
<p>During and after ROM flash (from step 2), there cannot be any user interaction anymore and all interrupts must be disabled! The screen writing that you see during flashing is executed directly from the program into the VERA, as no ROM screen IO functions can be used anymore.</p>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2022-10-16</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (c) 2022 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a1fd06ed563d27103c3ea13b94d4de6d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fd06ed563d27103c3ea13b94d4de6d5">&#9670;&nbsp;</a></span>rom_bank()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char rom_bank </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking the upper 5 bits (bit 18-14) and shifing those 14 bits to the right. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The 19 bit ROM address. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>unsigned char The ROM bank number for usage in ZP $01. </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a1fd06ed563d27103c3ea13b94d4de6d5_icgraph.png" border="0" usemap="#acx16-rom-flash_8c_a1fd06ed563d27103c3ea13b94d4de6d5_icgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a1fd06ed563d27103c3ea13b94d4de6d5_icgraph" id="acx16-rom-flash_8c_a1fd06ed563d27103c3ea13b94d4de6d5_icgraph">
<area shape="rect" title="Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking..." alt="" coords="517,31,596,57"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a85a543d5bc42e5a467cbdcd519163ab0" title="Read a byte from the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tr..." alt="" coords="360,5,468,32"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="359,56,469,83"/>
<area shape="rect" href="cx16-rom-flash_8c.html#adc8e7bb513e6936d98af34037c0f5a89" title="Write a byte and wait until the byte has been successfully flashed into the ROM." alt="" coords="180,31,311,57"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a5f4369522c0458285f171bda1eade3d9" title="Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to un..." alt="" coords="201,81,290,108"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf" title="Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be..." alt="" coords="5,81,132,108"/>
</map>
</div>

</div>
</div>
<a id="adc8e7bb513e6936d98af34037c0f5a89"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc8e7bb513e6936d98af34037c0f5a89">&#9670;&nbsp;</a></span>rom_byte_program()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rom_byte_program </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write a byte and wait until the byte has been successfully flashed into the ROM. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The 19 bit ROM address. </td></tr>
    <tr><td class="paramname">value</td><td>The byte value to be written. </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_adc8e7bb513e6936d98af34037c0f5a89_cgraph.png" border="0" usemap="#acx16-rom-flash_8c_adc8e7bb513e6936d98af34037c0f5a89_cgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_adc8e7bb513e6936d98af34037c0f5a89_cgraph" id="acx16-rom-flash_8c_adc8e7bb513e6936d98af34037c0f5a89_cgraph">
<area shape="rect" title="Write a byte and wait until the byte has been successfully flashed into the ROM." alt="" coords="5,31,136,57"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015" title="Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is cal..." alt="" coords="349,5,415,32"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a413ddcf851b4da292eb4391f72918ee9" title="Wait for the required time to allow the chip to flash the byte into the ROM. This is a core wait rout..." alt="" coords="202,31,277,57"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="184,81,295,108"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5" title="Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking..." alt="" coords="343,81,421,108"/>
</map>
</div>

</div>
</div>
<a id="a45f13cdc8334c213332cdd8edac28015"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45f13cdc8334c213332cdd8edac28015">&#9670;&nbsp;</a></span>rom_ptr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">brom_ptr_t rom_ptr </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is calculated by masking the lower 14 bits (bit 13-0), and then adding $C000 to it. The 16 bit ROM pointer is returned as a char* (brom_ptr_t). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The 19 bit ROM address. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>brom_ptr_t The 16 bit ROM pointer for the main CPU addressing. </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a45f13cdc8334c213332cdd8edac28015_icgraph.png" border="0" usemap="#acx16-rom-flash_8c_a45f13cdc8334c213332cdd8edac28015_icgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a45f13cdc8334c213332cdd8edac28015_icgraph" id="acx16-rom-flash_8c_a45f13cdc8334c213332cdd8edac28015_icgraph">
<area shape="rect" title="Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is cal..." alt="" coords="517,56,584,83"/>
<area shape="rect" href="cx16-rom-flash_8c.html#adc8e7bb513e6936d98af34037c0f5a89" title="Write a byte and wait until the byte has been successfully flashed into the ROM." alt="" coords="180,5,311,32"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a85a543d5bc42e5a467cbdcd519163ab0" title="Read a byte from the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tr..." alt="" coords="360,31,468,57"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf" title="Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be..." alt="" coords="5,107,132,133"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="359,81,469,108"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a5f4369522c0458285f171bda1eade3d9" title="Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to un..." alt="" coords="201,81,290,108"/>
</map>
</div>

</div>
</div>
<a id="a85a543d5bc42e5a467cbdcd519163ab0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85a543d5bc42e5a467cbdcd519163ab0">&#9670;&nbsp;</a></span>rom_read_byte()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char rom_read_byte </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a byte from the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are transformed into the <b>ptr_rom</b> 16 bit ROM address. The higher 5 bits of the 19 bit ROM address are transformed into the <b>bank_rom</b> 5 bit bank number. <b>bank_ptr* is used to set the bank using ZP $01. **ptr_rom</b> is used to read the byte. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The 19 bit ROM address. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>unsigned char The byte read from the ROM. </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a85a543d5bc42e5a467cbdcd519163ab0_cgraph.png" border="0" usemap="#acx16-rom-flash_8c_a85a543d5bc42e5a467cbdcd519163ab0_cgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a85a543d5bc42e5a467cbdcd519163ab0_cgraph" id="acx16-rom-flash_8c_a85a543d5bc42e5a467cbdcd519163ab0_cgraph">
<area shape="rect" title="Read a byte from the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tr..." alt="" coords="5,31,113,57"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5" title="Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking..." alt="" coords="161,5,240,32"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015" title="Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is cal..." alt="" coords="167,56,234,83"/>
</map>
</div>

</div>
</div>
<a id="a21fca991601518b6c85c5f8e70fabbbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21fca991601518b6c85c5f8e70fabbbf">&#9670;&nbsp;</a></span>rom_sector_erase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rom_sector_erase </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be flashed into the ROM. Erasing a sector of the ROM requires an erase sector sequence to be initiated, which has the following steps: </p>
<ol type="1">
<li>Write byte $AA into ROM address $005555.</li>
<li>Write byte $55 into ROM address $002AAA.</li>
<li>Write byte $80 into ROM address $005555.</li>
<li>Write byte $AA into ROM address $005555.</li>
<li>Write byte $55 into ROM address $002AAA.</li>
</ol>
<p>Once this write sequence is finished, the ROM sector is erased by writing byte $30 into the 19 bit ROM sector address. Then it waits until the chip has correctly flashed the ROM erasure.</p>
<p>Note that a ROM sector is 1KB (not 4KB), so the most 7 significant bits (18-12) are used. The remainder 12 low bits are ignored. </p><pre class="fragment">                              +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+  
                              | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
                              | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | 9 | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
                              +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+  
 SECTOR              0x7F000  | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
                              +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+  
 IGNORED             0x00FFF  | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 |
                              +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+  
</pre> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The 19 bit ROM address. </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a21fca991601518b6c85c5f8e70fabbbf_cgraph.png" border="0" usemap="#acx16-rom-flash_8c_a21fca991601518b6c85c5f8e70fabbbf_cgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a21fca991601518b6c85c5f8e70fabbbf_cgraph" id="acx16-rom-flash_8c_a21fca991601518b6c85c5f8e70fabbbf_cgraph">
<area shape="rect" title="Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be..." alt="" coords="5,56,132,83"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015" title="Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is cal..." alt="" coords="482,5,549,32"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a5f4369522c0458285f171bda1eade3d9" title="Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to un..." alt="" coords="180,56,269,83"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a413ddcf851b4da292eb4391f72918ee9" title="Wait for the required time to allow the chip to flash the byte into the ROM. This is a core wait rout..." alt="" coords="187,107,262,133"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="317,56,428,83"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5" title="Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking..." alt="" coords="476,56,555,83"/>
</map>
</div>

</div>
</div>
<a id="a5f4369522c0458285f171bda1eade3d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f4369522c0458285f171bda1eade3d9">&#9670;&nbsp;</a></span>rom_unlock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rom_unlock </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>unlock_code</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to unlock the ROM for flashing a byte. The 3rd byte can be variable, depending on the write sequence used, so this byte is a parameter into the routine. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The 3rd write to model the specific unlock sequence. </td></tr>
    <tr><td class="paramname">unlock_code</td><td>The 3rd write to model the specific unlock sequence. </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_cgraph.png" border="0" usemap="#acx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_cgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_cgraph" id="acx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_cgraph">
<area shape="rect" title="Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to un..." alt="" coords="5,31,95,57"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="143,31,253,57"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5" title="Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking..." alt="" coords="301,5,380,32"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015" title="Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is cal..." alt="" coords="307,56,374,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_icgraph.png" border="0" usemap="#acx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_icgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_icgraph" id="acx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_icgraph">
<area shape="rect" title="Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to un..." alt="" coords="180,5,269,32"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf" title="Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be..." alt="" coords="5,5,132,32"/>
</map>
</div>

</div>
</div>
<a id="a413ddcf851b4da292eb4391f72918ee9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a413ddcf851b4da292eb4391f72918ee9">&#9670;&nbsp;</a></span>rom_wait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rom_wait </td>
          <td>(</td>
          <td class="paramtype">brom_ptr_t&#160;</td>
          <td class="paramname"><em>ptr_rom</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for the required time to allow the chip to flash the byte into the ROM. This is a core wait routine which is the most important routine in this whole program. Once a byte is flashed into the ROM, it takes time for the chip to actually flash the byte. The chip has implemented a loop mechanism to guarantee correct flashing of the written byte. It does this by requiring the execution of two sequential reads from the previously written ROM address. And loop those sequential reads until bit 6 of the 2 read bytes are equal. Once those two bits are equal, the chip has successfully flashed the byte into the ROM. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ptr_rom</td><td>The 16 bit pointer where the byte was written. This pointer is used for the sequence reads to verify bit 6. </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a413ddcf851b4da292eb4391f72918ee9_icgraph.png" border="0" usemap="#acx16-rom-flash_8c_a413ddcf851b4da292eb4391f72918ee9_icgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a413ddcf851b4da292eb4391f72918ee9_icgraph" id="acx16-rom-flash_8c_a413ddcf851b4da292eb4391f72918ee9_icgraph">
<area shape="rect" title="Wait for the required time to allow the chip to flash the byte into the ROM. This is a core wait rout..." alt="" coords="184,31,259,57"/>
<area shape="rect" href="cx16-rom-flash_8c.html#adc8e7bb513e6936d98af34037c0f5a89" title="Write a byte and wait until the byte has been successfully flashed into the ROM." alt="" coords="5,5,136,32"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf" title="Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be..." alt="" coords="7,56,134,83"/>
</map>
</div>

</div>
</div>
<a id="a42ba9278c9feb3135a6bb465e8e2450a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42ba9278c9feb3135a6bb465e8e2450a">&#9670;&nbsp;</a></span>rom_write_byte()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rom_write_byte </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are transformed into the <b>ptr_rom</b> 16 bit ROM address. The higher 5 bits of the 19 bit ROM address are transformed into the <b>bank_rom</b> 5 bit bank number. <b>bank_ptr* is used to set the bank using ZP $01. **ptr_rom</b> is used to write the byte into the ROM. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The 19 bit ROM address. </td></tr>
    <tr><td class="paramname">value</td><td>The byte value to be written. </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_cgraph.png" border="0" usemap="#acx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_cgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_cgraph" id="acx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_cgraph">
<area shape="rect" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="5,31,116,57"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5" title="Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking..." alt="" coords="164,5,243,32"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015" title="Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is cal..." alt="" coords="170,56,237,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_icgraph.png" border="0" usemap="#acx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_icgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_icgraph" id="acx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_icgraph">
<area shape="rect" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="359,31,469,57"/>
<area shape="rect" href="cx16-rom-flash_8c.html#adc8e7bb513e6936d98af34037c0f5a89" title="Write a byte and wait until the byte has been successfully flashed into the ROM." alt="" coords="180,5,311,32"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a5f4369522c0458285f171bda1eade3d9" title="Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to un..." alt="" coords="201,56,290,83"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf" title="Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be..." alt="" coords="5,56,132,83"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="cx16-rom-flash_8c.html">cx16-rom-flash.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
