<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Commander X16 ROM Flash Utility: src/cx16-rom-flash.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Commander X16 ROM Flash Utility<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">This program flashes the ROM of the Commander X16 with a new ROM.BIN file.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('cx16-rom-flash_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">cx16-rom-flash.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;cx16.h&gt;</code><br />
<code>#include &lt;cx16-file.h&gt;</code><br />
<code>#include &lt;conio.h&gt;</code><br />
<code>#include &lt;printf.h&gt;</code><br />
<code>#include &lt;6502.h&gt;</code><br />
<code>#include &lt;kernal.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for cx16-rom-flash.c:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c__incl.png" border="0" usemap="#asrc_2cx16-rom-flash_8c" alt=""/></div>
<map name="asrc_2cx16-rom-flash_8c" id="asrc_2cx16-rom-flash_8c">
<area shape="rect" title=" " alt="" coords="202,5,342,31"/>
<area shape="rect" title=" " alt="" coords="5,79,67,104"/>
<area shape="rect" title=" " alt="" coords="91,79,173,104"/>
<area shape="rect" title=" " alt="" coords="197,79,261,104"/>
<area shape="rect" title=" " alt="" coords="285,79,347,104"/>
<area shape="rect" title=" " alt="" coords="371,79,432,104"/>
<area shape="rect" title=" " alt="" coords="457,79,525,104"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a67e0112c2a09b158464debe902a7c861"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a67e0112c2a09b158464debe902a7c861">__FLASH</a></td></tr>
<tr class="separator:a67e0112c2a09b158464debe902a7c861"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a652cff0033969443cc2f6f5389fbd9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a8a652cff0033969443cc2f6f5389fbd9">ROM_BASE</a>&#160;&#160;&#160;((unsigned int)0xC000)</td></tr>
<tr class="separator:a8a652cff0033969443cc2f6f5389fbd9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9e53d1418399b36953a40395ac1384d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#ad9e53d1418399b36953a40395ac1384d">ROM_SIZE</a>&#160;&#160;&#160;((unsigned int)0x4000)</td></tr>
<tr class="separator:ad9e53d1418399b36953a40395ac1384d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f2b7fa249d9d3affd06e7edfef1eff0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a8f2b7fa249d9d3affd06e7edfef1eff0">ROM_PTR_MASK</a>&#160;&#160;&#160;((unsigned long)0x03FFF)</td></tr>
<tr class="separator:a8f2b7fa249d9d3affd06e7edfef1eff0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99719b21a5d2432f868eac80997d77e7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a99719b21a5d2432f868eac80997d77e7">ROM_BANK_MASK</a>&#160;&#160;&#160;((unsigned long)0x7C000)</td></tr>
<tr class="separator:a99719b21a5d2432f868eac80997d77e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac224fac45a334ea85c5f091ab66037dd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#ac224fac45a334ea85c5f091ab66037dd">SST39SF010A</a>&#160;&#160;&#160;((unsigned char)0xB5)</td></tr>
<tr class="separator:ac224fac45a334ea85c5f091ab66037dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9073d886536fd49114afae0f29b28b27"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a9073d886536fd49114afae0f29b28b27">SST39SF020A</a>&#160;&#160;&#160;((unsigned char)0xB6)</td></tr>
<tr class="separator:a9073d886536fd49114afae0f29b28b27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a998c69bda3842e763def0f6c8bc75fd2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a998c69bda3842e763def0f6c8bc75fd2">SST39SF040</a>&#160;&#160;&#160;((unsigned char)0xB7)</td></tr>
<tr class="separator:a998c69bda3842e763def0f6c8bc75fd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1fd06ed563d27103c3ea13b94d4de6d5"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5">rom_bank</a> (unsigned long address)</td></tr>
<tr class="memdesc:a1fd06ed563d27103c3ea13b94d4de6d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking the upper 5 bits (bit 18-14) and shifing those 14 bits to the right.  <a href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5">More...</a><br /></td></tr>
<tr class="separator:a1fd06ed563d27103c3ea13b94d4de6d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45f13cdc8334c213332cdd8edac28015"><td class="memItemLeft" align="right" valign="top">brom_ptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015">rom_ptr</a> (unsigned long address)</td></tr>
<tr class="memdesc:a45f13cdc8334c213332cdd8edac28015"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is calculated by masking the lower 14 bits (bit 13-0), and then adding $C000 to it. The 16 bit ROM pointer is returned as a char* (brom_ptr_t).  <a href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015">More...</a><br /></td></tr>
<tr class="separator:a45f13cdc8334c213332cdd8edac28015"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85a543d5bc42e5a467cbdcd519163ab0"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a85a543d5bc42e5a467cbdcd519163ab0">rom_read_byte</a> (unsigned long address)</td></tr>
<tr class="memdesc:a85a543d5bc42e5a467cbdcd519163ab0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a byte from the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are transformed into the <b>ptr_rom</b> 16 bit ROM address. The higher 5 bits of the 19 bit ROM address are transformed into the <b>bank_rom</b> 5 bit bank number. <b>bank_ptr* is used to set the bank using ZP $01. **ptr_rom</b> is used to read the byte.  <a href="cx16-rom-flash_8c.html#a85a543d5bc42e5a467cbdcd519163ab0">More...</a><br /></td></tr>
<tr class="separator:a85a543d5bc42e5a467cbdcd519163ab0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42ba9278c9feb3135a6bb465e8e2450a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a">rom_write_byte</a> (unsigned long address, unsigned char value)</td></tr>
<tr class="memdesc:a42ba9278c9feb3135a6bb465e8e2450a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are transformed into the <b>ptr_rom</b> 16 bit ROM address. The higher 5 bits of the 19 bit ROM address are transformed into the <b>bank_rom</b> 5 bit bank number. <b>bank_ptr* is used to set the bank using ZP $01. **ptr_rom</b> is used to write the byte into the ROM.  <a href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a">More...</a><br /></td></tr>
<tr class="separator:a42ba9278c9feb3135a6bb465e8e2450a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a413ddcf851b4da292eb4391f72918ee9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a413ddcf851b4da292eb4391f72918ee9">rom_wait</a> (brom_ptr_t ptr_rom)</td></tr>
<tr class="memdesc:a413ddcf851b4da292eb4391f72918ee9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for the required time to allow the chip to flash the byte into the ROM. This is a core wait routine which is the most important routine in this whole program. Once a byte is flashed into the ROM, it takes time for the chip to actually flash the byte. The chip has implemented a loop mechanism to guarantee correct flashing of the written byte. It does this by requiring the execution of two sequential reads from the previously written ROM address. And loop those sequential reads until bit 6 of the 2 read bytes are equal. Once those two bits are equal, the chip has successfully flashed the byte into the ROM.  <a href="cx16-rom-flash_8c.html#a413ddcf851b4da292eb4391f72918ee9">More...</a><br /></td></tr>
<tr class="separator:a413ddcf851b4da292eb4391f72918ee9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f4369522c0458285f171bda1eade3d9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a5f4369522c0458285f171bda1eade3d9">rom_unlock</a> (unsigned long address, unsigned char unlock_code)</td></tr>
<tr class="memdesc:a5f4369522c0458285f171bda1eade3d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to unlock the ROM for flashing a byte. The 3rd byte can be variable, depending on the write sequence used, so this byte is a parameter into the routine.  <a href="cx16-rom-flash_8c.html#a5f4369522c0458285f171bda1eade3d9">More...</a><br /></td></tr>
<tr class="separator:a5f4369522c0458285f171bda1eade3d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc8e7bb513e6936d98af34037c0f5a89"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#adc8e7bb513e6936d98af34037c0f5a89">rom_byte_program</a> (unsigned long address, unsigned char value)</td></tr>
<tr class="memdesc:adc8e7bb513e6936d98af34037c0f5a89"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write a byte and wait until the byte has been successfully flashed into the ROM.  <a href="cx16-rom-flash_8c.html#adc8e7bb513e6936d98af34037c0f5a89">More...</a><br /></td></tr>
<tr class="separator:adc8e7bb513e6936d98af34037c0f5a89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21fca991601518b6c85c5f8e70fabbbf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf">rom_sector_erase</a> (unsigned long address)</td></tr>
<tr class="memdesc:a21fca991601518b6c85c5f8e70fabbbf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be flashed into the ROM. Erasing a sector of the ROM requires an erase sector sequence to be initiated, which has the following steps:  <a href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf">More...</a><br /></td></tr>
<tr class="separator:a21fca991601518b6c85c5f8e70fabbbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdef7a1fd863a6d3770c1268cb06add3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cx16-rom-flash_8c.html#acdef7a1fd863a6d3770c1268cb06add3">main</a> ()</td></tr>
<tr class="separator:acdef7a1fd863a6d3770c1268cb06add3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a67e0112c2a09b158464debe902a7c861" name="a67e0112c2a09b158464debe902a7c861"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67e0112c2a09b158464debe902a7c861">&#9670;&#160;</a></span>__FLASH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FLASH</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a99719b21a5d2432f868eac80997d77e7" name="a99719b21a5d2432f868eac80997d77e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99719b21a5d2432f868eac80997d77e7">&#9670;&#160;</a></span>ROM_BANK_MASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ROM_BANK_MASK&#160;&#160;&#160;((unsigned long)0x7C000)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8a652cff0033969443cc2f6f5389fbd9" name="a8a652cff0033969443cc2f6f5389fbd9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a652cff0033969443cc2f6f5389fbd9">&#9670;&#160;</a></span>ROM_BASE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ROM_BASE&#160;&#160;&#160;((unsigned int)0xC000)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8f2b7fa249d9d3affd06e7edfef1eff0" name="a8f2b7fa249d9d3affd06e7edfef1eff0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f2b7fa249d9d3affd06e7edfef1eff0">&#9670;&#160;</a></span>ROM_PTR_MASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ROM_PTR_MASK&#160;&#160;&#160;((unsigned long)0x03FFF)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad9e53d1418399b36953a40395ac1384d" name="ad9e53d1418399b36953a40395ac1384d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9e53d1418399b36953a40395ac1384d">&#9670;&#160;</a></span>ROM_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ROM_SIZE&#160;&#160;&#160;((unsigned int)0x4000)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac224fac45a334ea85c5f091ab66037dd" name="ac224fac45a334ea85c5f091ab66037dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac224fac45a334ea85c5f091ab66037dd">&#9670;&#160;</a></span>SST39SF010A</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SST39SF010A&#160;&#160;&#160;((unsigned char)0xB5)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9073d886536fd49114afae0f29b28b27" name="a9073d886536fd49114afae0f29b28b27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9073d886536fd49114afae0f29b28b27">&#9670;&#160;</a></span>SST39SF020A</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SST39SF020A&#160;&#160;&#160;((unsigned char)0xB6)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a998c69bda3842e763def0f6c8bc75fd2" name="a998c69bda3842e763def0f6c8bc75fd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a998c69bda3842e763def0f6c8bc75fd2">&#9670;&#160;</a></span>SST39SF040</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SST39SF040&#160;&#160;&#160;((unsigned char)0xB7)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="acdef7a1fd863a6d3770c1268cb06add3" name="acdef7a1fd863a6d3770c1268cb06add3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdef7a1fd863a6d3770c1268cb06add3">&#9670;&#160;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_acdef7a1fd863a6d3770c1268cb06add3_cgraph.png" border="0" usemap="#acx16-rom-flash_8c_acdef7a1fd863a6d3770c1268cb06add3_cgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_acdef7a1fd863a6d3770c1268cb06add3_cgraph" id="acx16-rom-flash_8c_acdef7a1fd863a6d3770c1268cb06add3_cgraph">
<area shape="rect" title=" " alt="" coords="5,126,56,151"/>
<area shape="rect" href="cx16-rom-flash_8c.html#adc8e7bb513e6936d98af34037c0f5a89" title="Write a byte and wait until the byte has been successfully flashed into the ROM." alt="" coords="104,24,235,50"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a85a543d5bc42e5a467cbdcd519163ab0" title="Read a byte from the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tr..." alt="" coords="421,200,529,226"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf" title="Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be..." alt="" coords="106,100,233,126"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a5f4369522c0458285f171bda1eade3d9" title="Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to un..." alt="" coords="283,151,372,176"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015" title="Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is cal..." alt="" coords="585,114,651,139"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a413ddcf851b4da292eb4391f72918ee9" title="Wait for the required time to allow the chip to flash the byte into the ROM. This is a core wait rout..." alt="" coords="290,50,365,75"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="420,151,531,176"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5" title="Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking..." alt="" coords="579,176,657,202"/>
</map>
</div>

</div>
</div>
<a id="a1fd06ed563d27103c3ea13b94d4de6d5" name="a1fd06ed563d27103c3ea13b94d4de6d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fd06ed563d27103c3ea13b94d4de6d5">&#9670;&#160;</a></span>rom_bank()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char rom_bank </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking the upper 5 bits (bit 18-14) and shifing those 14 bits to the right. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The 19 bit ROM address. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>unsigned char The ROM bank number for usage in ZP $01. </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a1fd06ed563d27103c3ea13b94d4de6d5_icgraph.png" border="0" usemap="#acx16-rom-flash_8c_a1fd06ed563d27103c3ea13b94d4de6d5_icgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a1fd06ed563d27103c3ea13b94d4de6d5_icgraph" id="acx16-rom-flash_8c_a1fd06ed563d27103c3ea13b94d4de6d5_icgraph">
<area shape="rect" title="Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking..." alt="" coords="616,31,695,56"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a85a543d5bc42e5a467cbdcd519163ab0" title="Read a byte from the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tr..." alt="" coords="113,5,221,31"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="457,56,568,81"/>
<area shape="rect" href="cx16-rom-flash_8c.html#acdef7a1fd863a6d3770c1268cb06add3" title=" " alt="" coords="5,81,56,107"/>
<area shape="rect" href="cx16-rom-flash_8c.html#adc8e7bb513e6936d98af34037c0f5a89" title="Write a byte and wait until the byte has been successfully flashed into the ROM." alt="" coords="279,56,409,81"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a5f4369522c0458285f171bda1eade3d9" title="Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to un..." alt="" coords="299,107,389,132"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf" title="Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be..." alt="" coords="104,157,231,183"/>
</map>
</div>

</div>
</div>
<a id="adc8e7bb513e6936d98af34037c0f5a89" name="adc8e7bb513e6936d98af34037c0f5a89"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc8e7bb513e6936d98af34037c0f5a89">&#9670;&#160;</a></span>rom_byte_program()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rom_byte_program </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write a byte and wait until the byte has been successfully flashed into the ROM. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The 19 bit ROM address. </td></tr>
    <tr><td class="paramname">value</td><td>The byte value to be written. </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_adc8e7bb513e6936d98af34037c0f5a89_cgraph.png" border="0" usemap="#acx16-rom-flash_8c_adc8e7bb513e6936d98af34037c0f5a89_cgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_adc8e7bb513e6936d98af34037c0f5a89_cgraph" id="acx16-rom-flash_8c_adc8e7bb513e6936d98af34037c0f5a89_cgraph">
<area shape="rect" title="Write a byte and wait until the byte has been successfully flashed into the ROM." alt="" coords="5,31,136,56"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015" title="Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is cal..." alt="" coords="349,5,415,31"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a413ddcf851b4da292eb4391f72918ee9" title="Wait for the required time to allow the chip to flash the byte into the ROM. This is a core wait rout..." alt="" coords="202,31,277,56"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="184,80,295,105"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5" title="Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking..." alt="" coords="343,80,421,105"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_adc8e7bb513e6936d98af34037c0f5a89_icgraph.png" border="0" usemap="#acx16-rom-flash_8c_adc8e7bb513e6936d98af34037c0f5a89_icgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_adc8e7bb513e6936d98af34037c0f5a89_icgraph" id="acx16-rom-flash_8c_adc8e7bb513e6936d98af34037c0f5a89_icgraph">
<area shape="rect" title="Write a byte and wait until the byte has been successfully flashed into the ROM." alt="" coords="104,5,235,31"/>
<area shape="rect" href="cx16-rom-flash_8c.html#acdef7a1fd863a6d3770c1268cb06add3" title=" " alt="" coords="5,5,56,31"/>
</map>
</div>

</div>
</div>
<a id="a45f13cdc8334c213332cdd8edac28015" name="a45f13cdc8334c213332cdd8edac28015"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45f13cdc8334c213332cdd8edac28015">&#9670;&#160;</a></span>rom_ptr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">brom_ptr_t rom_ptr </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is calculated by masking the lower 14 bits (bit 13-0), and then adding $C000 to it. The 16 bit ROM pointer is returned as a char* (brom_ptr_t). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The 19 bit ROM address. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>brom_ptr_t The 16 bit ROM pointer for the main CPU addressing. </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a45f13cdc8334c213332cdd8edac28015_icgraph.png" border="0" usemap="#acx16-rom-flash_8c_a45f13cdc8334c213332cdd8edac28015_icgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a45f13cdc8334c213332cdd8edac28015_icgraph" id="acx16-rom-flash_8c_a45f13cdc8334c213332cdd8edac28015_icgraph">
<area shape="rect" title="Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is cal..." alt="" coords="616,81,683,107"/>
<area shape="rect" href="cx16-rom-flash_8c.html#adc8e7bb513e6936d98af34037c0f5a89" title="Write a byte and wait until the byte has been successfully flashed into the ROM." alt="" coords="279,56,409,81"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a85a543d5bc42e5a467cbdcd519163ab0" title="Read a byte from the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tr..." alt="" coords="113,5,221,31"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf" title="Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be..." alt="" coords="104,157,231,183"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="457,107,568,132"/>
<area shape="rect" href="cx16-rom-flash_8c.html#acdef7a1fd863a6d3770c1268cb06add3" title=" " alt="" coords="5,81,56,107"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a5f4369522c0458285f171bda1eade3d9" title="Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to un..." alt="" coords="299,107,389,132"/>
</map>
</div>

</div>
</div>
<a id="a85a543d5bc42e5a467cbdcd519163ab0" name="a85a543d5bc42e5a467cbdcd519163ab0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85a543d5bc42e5a467cbdcd519163ab0">&#9670;&#160;</a></span>rom_read_byte()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char rom_read_byte </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a byte from the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are transformed into the <b>ptr_rom</b> 16 bit ROM address. The higher 5 bits of the 19 bit ROM address are transformed into the <b>bank_rom</b> 5 bit bank number. <b>bank_ptr* is used to set the bank using ZP $01. **ptr_rom</b> is used to read the byte. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The 19 bit ROM address. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>unsigned char The byte read from the ROM. </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a85a543d5bc42e5a467cbdcd519163ab0_cgraph.png" border="0" usemap="#acx16-rom-flash_8c_a85a543d5bc42e5a467cbdcd519163ab0_cgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a85a543d5bc42e5a467cbdcd519163ab0_cgraph" id="acx16-rom-flash_8c_a85a543d5bc42e5a467cbdcd519163ab0_cgraph">
<area shape="rect" title="Read a byte from the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tr..." alt="" coords="5,31,113,56"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5" title="Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking..." alt="" coords="161,5,240,31"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015" title="Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is cal..." alt="" coords="167,55,234,80"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a85a543d5bc42e5a467cbdcd519163ab0_icgraph.png" border="0" usemap="#acx16-rom-flash_8c_a85a543d5bc42e5a467cbdcd519163ab0_icgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a85a543d5bc42e5a467cbdcd519163ab0_icgraph" id="acx16-rom-flash_8c_a85a543d5bc42e5a467cbdcd519163ab0_icgraph">
<area shape="rect" title="Read a byte from the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tr..." alt="" coords="104,5,212,31"/>
<area shape="rect" href="cx16-rom-flash_8c.html#acdef7a1fd863a6d3770c1268cb06add3" title=" " alt="" coords="5,5,56,31"/>
</map>
</div>

</div>
</div>
<a id="a21fca991601518b6c85c5f8e70fabbbf" name="a21fca991601518b6c85c5f8e70fabbbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21fca991601518b6c85c5f8e70fabbbf">&#9670;&#160;</a></span>rom_sector_erase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rom_sector_erase </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be flashed into the ROM. Erasing a sector of the ROM requires an erase sector sequence to be initiated, which has the following steps: </p>
<ol type="1">
<li>Write byte $AA into ROM address $005555.</li>
<li>Write byte $55 into ROM address $002AAA.</li>
<li>Write byte $80 into ROM address $005555.</li>
<li>Write byte $AA into ROM address $005555.</li>
<li>Write byte $55 into ROM address $002AAA.</li>
</ol>
<p >Once this write sequence is finished, the ROM sector is erased by writing byte $30 into the 19 bit ROM sector address. Then it waits until the chip has correctly flashed the ROM erasure.</p>
<p >Note that a ROM sector is 1KB (not 4KB), so the most 7 significant bits (18-12) are used. The remainder 12 low bits are ignored. </p><pre class="fragment">                              +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+  
                              | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
                              | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 | 9 | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
                              +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+  
 SECTOR              0x7F000  | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
                              +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+  
 IGNORED             0x00FFF  | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 |
                              +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+  
</pre> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The 19 bit ROM address. </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a21fca991601518b6c85c5f8e70fabbbf_cgraph.png" border="0" usemap="#acx16-rom-flash_8c_a21fca991601518b6c85c5f8e70fabbbf_cgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a21fca991601518b6c85c5f8e70fabbbf_cgraph" id="acx16-rom-flash_8c_a21fca991601518b6c85c5f8e70fabbbf_cgraph">
<area shape="rect" title="Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be..." alt="" coords="5,55,132,80"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015" title="Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is cal..." alt="" coords="482,5,549,31"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a5f4369522c0458285f171bda1eade3d9" title="Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to un..." alt="" coords="180,55,269,80"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a413ddcf851b4da292eb4391f72918ee9" title="Wait for the required time to allow the chip to flash the byte into the ROM. This is a core wait rout..." alt="" coords="187,104,262,129"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="317,55,428,80"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5" title="Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking..." alt="" coords="476,55,555,80"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a21fca991601518b6c85c5f8e70fabbbf_icgraph.png" border="0" usemap="#acx16-rom-flash_8c_a21fca991601518b6c85c5f8e70fabbbf_icgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a21fca991601518b6c85c5f8e70fabbbf_icgraph" id="acx16-rom-flash_8c_a21fca991601518b6c85c5f8e70fabbbf_icgraph">
<area shape="rect" title="Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be..." alt="" coords="104,5,231,31"/>
<area shape="rect" href="cx16-rom-flash_8c.html#acdef7a1fd863a6d3770c1268cb06add3" title=" " alt="" coords="5,5,56,31"/>
</map>
</div>

</div>
</div>
<a id="a5f4369522c0458285f171bda1eade3d9" name="a5f4369522c0458285f171bda1eade3d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f4369522c0458285f171bda1eade3d9">&#9670;&#160;</a></span>rom_unlock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rom_unlock </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>unlock_code</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to unlock the ROM for flashing a byte. The 3rd byte can be variable, depending on the write sequence used, so this byte is a parameter into the routine. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The 3rd write to model the specific unlock sequence. </td></tr>
    <tr><td class="paramname">unlock_code</td><td>The 3rd write to model the specific unlock sequence. </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_cgraph.png" border="0" usemap="#acx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_cgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_cgraph" id="acx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_cgraph">
<area shape="rect" title="Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to un..." alt="" coords="5,31,95,56"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a42ba9278c9feb3135a6bb465e8e2450a" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="143,31,253,56"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5" title="Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking..." alt="" coords="301,5,380,31"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015" title="Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is cal..." alt="" coords="307,55,374,80"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_icgraph.png" border="0" usemap="#acx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_icgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_icgraph" id="acx16-rom-flash_8c_a5f4369522c0458285f171bda1eade3d9_icgraph">
<area shape="rect" title="Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to un..." alt="" coords="279,5,368,31"/>
<area shape="rect" href="cx16-rom-flash_8c.html#acdef7a1fd863a6d3770c1268cb06add3" title=" " alt="" coords="5,5,56,31"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf" title="Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be..." alt="" coords="104,31,231,56"/>
</map>
</div>

</div>
</div>
<a id="a413ddcf851b4da292eb4391f72918ee9" name="a413ddcf851b4da292eb4391f72918ee9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a413ddcf851b4da292eb4391f72918ee9">&#9670;&#160;</a></span>rom_wait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rom_wait </td>
          <td>(</td>
          <td class="paramtype">brom_ptr_t&#160;</td>
          <td class="paramname"><em>ptr_rom</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for the required time to allow the chip to flash the byte into the ROM. This is a core wait routine which is the most important routine in this whole program. Once a byte is flashed into the ROM, it takes time for the chip to actually flash the byte. The chip has implemented a loop mechanism to guarantee correct flashing of the written byte. It does this by requiring the execution of two sequential reads from the previously written ROM address. And loop those sequential reads until bit 6 of the 2 read bytes are equal. Once those two bits are equal, the chip has successfully flashed the byte into the ROM. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ptr_rom</td><td>The 16 bit pointer where the byte was written. This pointer is used for the sequence reads to verify bit 6. </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a413ddcf851b4da292eb4391f72918ee9_icgraph.png" border="0" usemap="#acx16-rom-flash_8c_a413ddcf851b4da292eb4391f72918ee9_icgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a413ddcf851b4da292eb4391f72918ee9_icgraph" id="acx16-rom-flash_8c_a413ddcf851b4da292eb4391f72918ee9_icgraph">
<area shape="rect" title="Wait for the required time to allow the chip to flash the byte into the ROM. This is a core wait rout..." alt="" coords="283,31,357,56"/>
<area shape="rect" href="cx16-rom-flash_8c.html#adc8e7bb513e6936d98af34037c0f5a89" title="Write a byte and wait until the byte has been successfully flashed into the ROM." alt="" coords="104,5,235,31"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf" title="Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be..." alt="" coords="106,55,233,80"/>
<area shape="rect" href="cx16-rom-flash_8c.html#acdef7a1fd863a6d3770c1268cb06add3" title=" " alt="" coords="5,31,56,56"/>
</map>
</div>

</div>
</div>
<a id="a42ba9278c9feb3135a6bb465e8e2450a" name="a42ba9278c9feb3135a6bb465e8e2450a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42ba9278c9feb3135a6bb465e8e2450a">&#9670;&#160;</a></span>rom_write_byte()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rom_write_byte </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are transformed into the <b>ptr_rom</b> 16 bit ROM address. The higher 5 bits of the 19 bit ROM address are transformed into the <b>bank_rom</b> 5 bit bank number. <b>bank_ptr* is used to set the bank using ZP $01. **ptr_rom</b> is used to write the byte into the ROM. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The 19 bit ROM address. </td></tr>
    <tr><td class="paramname">value</td><td>The byte value to be written. </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_cgraph.png" border="0" usemap="#acx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_cgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_cgraph" id="acx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_cgraph">
<area shape="rect" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="5,31,116,56"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a1fd06ed563d27103c3ea13b94d4de6d5" title="Calculates the 5 bit ROM bank from the ROM 19 bit address. The ROM bank number is calcuated by taking..." alt="" coords="164,5,243,31"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a45f13cdc8334c213332cdd8edac28015" title="Calcuates the 16 bit ROM pointer from the ROM using the 19 bit address. The 16 bit ROM pointer is cal..." alt="" coords="170,55,237,80"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="cx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_icgraph.png" border="0" usemap="#acx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_icgraph" alt=""/></div>
<map name="acx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_icgraph" id="acx16-rom-flash_8c_a42ba9278c9feb3135a6bb465e8e2450a_icgraph">
<area shape="rect" title="Write a byte to the ROM using the 19 bit address. The lower 14 bits of the 19 bit ROM address are tra..." alt="" coords="420,31,531,56"/>
<area shape="rect" href="cx16-rom-flash_8c.html#adc8e7bb513e6936d98af34037c0f5a89" title="Write a byte and wait until the byte has been successfully flashed into the ROM." alt="" coords="104,5,235,31"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a5f4369522c0458285f171bda1eade3d9" title="Unlock a byte location for flashing using the 19 bit address. This is a various purpose routine to un..." alt="" coords="283,56,372,81"/>
<area shape="rect" href="cx16-rom-flash_8c.html#acdef7a1fd863a6d3770c1268cb06add3" title=" " alt="" coords="5,56,56,81"/>
<area shape="rect" href="cx16-rom-flash_8c.html#a21fca991601518b6c85c5f8e70fabbbf" title="Erases a 1KB sector of the ROM using the 19 bit address. This is required before any new bytes can be..." alt="" coords="106,107,233,132"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="cx16-rom-flash_8c.html">cx16-rom-flash.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
